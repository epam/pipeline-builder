env:
    - EMAIL="dsavchuk93@yandex.ru" NPM_AUTH_TOKEN="84251c56-7dcc-496d-8661-9529f5711868" PACKAGE_NAME="pipeline-builder-test"
language: node_js
node_js: "6"
os: linux
dist: trusty
before_install: 
    - |-
          if [[ $TRAVIS_BRANCH == "dev" ]] || [[ $TRAVIS_BRAHCH == "master" ]]; then
              NPM_TAG="$(if [[ $TRAVIS_BRANCH == "dev" ]]; then echo "dev"; else echo "latest"; fi)"

              LAST_PUBLISHED="$(npm view $PACKAGE_NAME@$NPM_TAG version)"
              CURRENT_VERSION="$(npm version | grep -Po "(?<='$PACKAGE_NAME': ')[^']*")"

              if [[ $LAST_PUBLISHED == $CURRENT_VERSION ]]; then 
                  exit 1; 
              fi
          fi
install: 
    - yarn global add gulp-cli
    - yarn install
script: gulp
after_script: gulp test:coveralls
deploy:
    - provider: npm
      email: $EMAIL
      api_key: $NPM_AUTH_TOKEN
      tag: dev
      on:
          branch: dev
    - provider: npm
      email: $EMAIL
      api_key: $NPM_AUTH_TOKEN
      tag: latest
      on:
          branch: master
after_deploy:
    - "curl \"http://35.164.165.183:8080/job/pipeline-wdl-builder/build?token=testpbbuild\""